<div class="row" style="margin-right: -15px;margin-left: -15px;">
    <div class="col-md-5">
		<!--- Чарты --->

		<!-- Resources -->
		<script src="<#ROOTHTML#>3rdparty/amcharts/core.js"></script>
		<script src="<#ROOTHTML#>3rdparty/amcharts/charts.js"></script>
		<script src="<#ROOTHTML#>3rdparty/amcharts/material.js"></script>
		<script src="<#ROOTHTML#>3rdparty/amcharts/animated.js"></script>

		<div id="hint_blockaddnewdev" style="display:none">
			<div class="panel panel-default" style="margin-bottom: 0px;">
				<div class="panel-body">
					<a href="?(panel:{action=devices})&md=devices&view_mode=edit_devices" class="btn btn-default"><i class="glyphicon glyphicon-plus"></i> <#LANG_DEVICE#></a>
					<a href="?(panel:{action=scripts})&md=scripts&inst=adm&view_mode=edit_scripts" class="btn btn-default"><i class="glyphicon glyphicon-plus"></i> <#LANG_SCRIPT#></a>
					<a href="?(panel:{action=objects})&md=objects&view_mode=edit_objects&id=" class="btn btn-default"><i class="glyphicon glyphicon-plus"></i> <#LANG_OBJECT#></a>
					<a href="?(panel:{action=classes})&md=classes&inst=adm&view_mode=edit_classes" class="btn btn-default"><i class="glyphicon glyphicon-plus"></i> <#LANG_NEWDASH_CLASS#></a>
				</div>
			</div>
			<div onclick="hideHintCookie('blockaddnewdev');" style="margin-bottom: 20px;cursor:pointer;text-align: center;font-size: 7pt;margin-top: 5px;color: gray;font-style: italic;"><#LANG_NEWDASH_DONTSHOW_THIS_BLOCK#> <i class="glyphicon glyphicon-arrow-up"></i></div>
		</div>
		<!--- Генерация своего блока --->
		<div class="panel panel-info" id="myBlockOnDash" style="display:none;">
			<div class="panel-heading">
				<div style="float: left"><h3 class="panel-title" id="myBlockOnDash_title"></h3></div>
				<div style="float: right"><i id="hideTogglemyBlock" style="cursor:pointer;" onclick="return toggleCategory('myBlockDiv');" class="glyphicon glyphicon-eye-close"></i></div>
				<div class="clearfix"></div>
			</div>
			<div class="panel-collapse collapse out" id="row_myBlockDiv">
				<div class="panel-body" id="myBlockOnDash_body"></div>
				
				<div class="panel-body" id="more_myBlockOnDash" style="display:none;">
					<ul class="list-group" id="more_myBlockOnDash_body">
						
					</ul>
				</div>
			</div>
		</div>

		<div class="panel panel-default">
			<div class="panel-heading">
				<div style="float: left"><h3 class="panel-title"><#LANG_NEWDASH_SYSTEM_INFO#></h3></div>
				<div style="float: right"><i style="cursor:pointer;" onclick="return toggleCategory('infoBlockDiv');" class="glyphicon glyphicon-eye-close"></i></div>
				<div class="clearfix"></div>
			</div>
			<div class="panel-collapse collapse out" id="row_infoBlockDiv">
				<div class="panel-body">
					<ul class="list-group" id="">
						<li class="list-group-item">
							<#LANG_DEVICES_STATUS#> WebSocket
							<span id="wsStatus" class="badge" style="background:transparent;"><img src="<#ROOTHTML#>img/ajax-loader.gif"/></span>
						</li>
						
						<li class="list-group-item" onclick="$('.reqPerMinHour').toggle('slow');" style="cursor:pointer">
							<#LANG_NEWDASH_DB_REQ_SEC#>
							<span id="dashInfoDBReqS" onmouseover="$('#dbreqdiscus').show('slow');" class="badge" style="background:transparent;"><img src="<#ROOTHTML#>img/ajax-loader.gif"/></span>
						</li>
						<li class="list-group-item reqPerMinHour" style="display:none;">
							<#LANG_NEWDASH_DB_REQ_MIN#>
							<span id="dashInfoDBReqM" onmouseover="$('#dbreqdiscus').show('slow');" class="badge" style="background:transparent;"><img src="<#ROOTHTML#>img/ajax-loader.gif"/></span>
						</li>
						<li class="list-group-item reqPerMinHour" style="display:none;">
							<#LANG_NEWDASH_DB_REQ_HOUR#>
							<span id="dashInfoDBReqH" onmouseover="$('#dbreqdiscus').show('slow');" class="badge" style="background:transparent;"><img src="<#ROOTHTML#>img/ajax-loader.gif"/></span>
						</li>
						<li class="list-group-item text-center" id="dbreqdiscus" style="display:none;background: radial-gradient(circle farthest-corner at 100px 50px, #daffe5, #d6ecff);">
							<a href="https://mjdm.ru/forum/viewtopic.php?f=6&t=7301" style="text-decoration:none;color: #333;" target="_blank"><i style="margin-right: 10px;vertical-align: top;" class="glyphicon glyphicon-send"></i><#LANG_NEWDASH_FORUM_DISCUSSION#></a>
						</li>
						
					</ul>
					<div class="well well-lg" id="dashInfoOS"><center><img src="<#ROOTHTML#>img/ajax-loader.gif"/> <#LANG_NEWDASH_LOADING#></center></div>
				</div>
			</div>
		</div>
	
		<div class="panel panel-default">
			<div class="panel-heading">
				<div style="float: left"><h3 class="panel-title"><#LANG_NEWDASH_LAST_SCRIPTS#> <i class="glyphicon glyphicon-arrow-right" style="color: darkgray;font-size: 10pt;"></i> <a href="?pd=pz_&md=panel&inst=&action=scripts"><i><#LANG_NEWDASH_LAST_SCRIPTS_GO#></i></a></h3></div>
				<div style="float: right"><i style="cursor:pointer;" onclick="return toggleCategory('scriptBlockDiv');" class="glyphicon glyphicon-eye-close"></i></div>
				<div class="clearfix"></div>
			</div>
			<div class="panel-collapse collapse out" id="row_scriptBlockDiv">
				<div class="panel-body">
					<div class="alert" style="background: radial-gradient(circle farthest-corner at 450px 10px, #a6e7bb, #0e6080);color: white;text-align: center;border: 0px;"><i class="glyphicon glyphicon-exclamation-sign" style="font-weight: normal;font-size: 13pt;vertical-align: sub;margin-right: 10px;"></i><#LANG_NEWDASH_SHOW_LAST_SCRIPTS#></div>
					<ul class="list-group" id="scriptLast">
						<center><img src="<#ROOTHTML#>img/ajax-loader.gif"/> <#LANG_NEWDASH_LOADING#></center>
					</ul>
				</div>
			</div>
		</div>
		
	</div>
	<div class="col-md-7">
		<script>
		am4core.ready(function() {

		// Themes begin
		am4core.useTheme(am4themes_material);
		am4core.useTheme(am4themes_animated);
		// Themes end

		var chart = am4core.create("structureDB_chart", am4charts.XYChart);
		chart.logo.disabled = true;
		
		chart.dataSource.url = "?action=xray&md=xray&inst=adm&view_mode=database&ajax=1&op=getcontent&mode=chart";
		chart.dataSource.parser = new am4core.JSONParser();
		chart.dataSource.reloadFrequency = 180000;
		

		chart.padding(20, 20, 20, 20);

		var categoryAxis = chart.xAxes.push(new am4charts.CategoryAxis());
		categoryAxis.renderer.grid.template.location = 0;
		categoryAxis.dataFields.category = "NAME";
		categoryAxis.renderer.minGridDistance = 10;
		categoryAxis.renderer.inversed = false;
		categoryAxis.renderer.grid.template.disabled = true;
		categoryAxis.renderer.labels.template.adapter.add("dy", function(dy, target) {
		  if (target.dataItem && target.dataItem.index & 2 == 2) {
			return dy + 25;
		  }
		  return dy;
		});

		var valueAxis = chart.yAxes.push(new am4charts.ValueAxis());

		valueAxis.calculateTotals = true;
		/*
		valueAxis.min = 0;
		valueAxis.max = 150000;
		valueAxis.strictMinMax = true;
		 */
		
		chart.cursor = new am4charts.XYCursor();
		chart.scrollbarY = new am4core.Scrollbar();
		chart.scrollbarY.parent = chart.leftAxesContainer;

		chart.cursor.behavior = "none";

		var series = chart.series.push(new am4charts.ColumnSeries());
		series.dataFields.categoryX = "NAME";
		series.dataFields.valueY = "ROWS";
		series.tooltipText = "{valueY.value}"
		series.columns.template.strokeOpacity = 0;
		series.columns.template.column.cornerRadiusTopRight = 4;
		series.columns.template.column.cornerRadiusTopLeft = 4;
		var labelBullet = series.bullets.push(new am4charts.LabelBullet());
		labelBullet.label.verticalCenter = "bottom";
		labelBullet.label.dy = -10;
		labelBullet.label.text = "{values.valueY.workingValue.formatNumber('#.')}";

		chart.zoomOutButton.disabled = true;

		series.columns.template.adapter.add("fill", function (fill, target) {
			return chart.colors.getIndex(target.dataItem.index);
		});

		setInterval(function () {
			am4core.array.each(chart.data, function (item) {
				item.visits += Math.round(Math.random() * 200 - 100);
				item.visits = Math.abs(item.visits);
			})
			chart.invalidateRawData();
		}, 20000)

		categoryAxis.sortBySeries = series;

		});
		</script>
		<!-- HTML -->
		<div class="panel panel-default">
			<div class="panel-heading">
				<div style="float: left"><h3 class="panel-title"><#LANG_NEWDASH_CYCLE_CONTROL#> <i class="glyphicon glyphicon-arrow-right" style="color: darkgray;font-size: 10pt;"></i> <a href="?(panel:{action=xray})&md=xray&inst=adm&view_mode=services">X-Ray</a></h3></div>
				<div style="float: right"><i style="cursor:pointer;" onclick="return toggleCategory('cycleBlockDiv');" class="glyphicon glyphicon-eye-close"></i></div>
				<div class="clearfix"></div>
			</div>
			<div class="panel-collapse collapse out" id="row_cycleBlockDiv" style="margin-bottom: 0px;">
				<div class="panel-body">
					<!-- Chart code -->
					<script>
					am4core.ready(function() {

					// Themes begin
					am4core.useTheme(am4themes_material);
					am4core.useTheme(am4themes_animated);
					// Themes end

					var chart = am4core.create("chartdiv_cycle", am4charts.PieChart);
					chart.hiddenState.properties.opacity = 0; // this creates initial fade-in
					chart.logo.disabled = true;
					
					chart.dataSource.url = "?action=xray&md=xray&inst=adm&view_mode=services&ajax=1&op=getcontent&mode=chart";
					chart.dataSource.parser = new am4core.JSONParser();
					chart.dataSource.reloadFrequency = 30000;
					
					chart.radius = am4core.percent(60);
					chart.innerRadius = am4core.percent(40);
					chart.startAngle = 180;
					chart.endAngle = 360;  

					var series = chart.series.push(new am4charts.PieSeries());
					series.dataFields.value = "cycle";
					series.dataFields.category = "title";
					series.dataFields.cyclename = "cyclename";
					
					series.slices.template.propertyFields.fill = "color";
					series.slices.template.cornerRadius = 0;
					series.slices.template.innerCornerRadius = 0;
					series.slices.template.draggable = true;
					series.slices.template.inert = true;
					series.alignLabels = false;

					series.hiddenState.properties.startAngle = 90;
					series.hiddenState.properties.endAngle = 90;

					chart.legend = new am4charts.Legend();
					chart.legend.useDefaultMarker = true;
					var marker = chart.legend.markers.template.children.getIndex(0);
					marker.cornerRadius(12, 12, 12, 12);
					marker.strokeWidth = 2;
					marker.strokeOpacity = 1;
					marker.stroke = am4core.color("#ccc");
					chart.legend.labels.template.text = "[bold {color}]{cyclename}[/]";
					
					
					}); // end am4core.ready()
					</script>

					<!-- HTML -->
					<div id="chartdiv_cycle" style="width: 100%;height: 200px;"><center><img src="<#ROOTHTML#>img/ajax-loader.gif"/> <#LANG_NEWDASH_LOADING#></center></div>
				</div>
			</div>
		</div>
		
		<div id="hint_howmaxdbsizehint" style="display:none;">
			<div class="alert" style="background: radial-gradient(circle farthest-corner at 450px 10px, #be5959, #caa417);color: white;text-align: center;border: 0px;"><i class="glyphicon glyphicon-exclamation-sign" style="font-weight: normal;font-size: 13pt;vertical-align: sub;margin-right: 10px;"></i><#LANG_NEWDASH_HINT_BIG_DATA_DB#> <i class="glyphicon glyphicon-arrow-right" style="color: darkgray;font-size: 10pt;vertical-align: text-top;"></i> <a style="text-decoration: none;color: white;" href="?(panel:{action=xray})&md=xray&inst=adm&view_mode=database">X-Ray</a></div>
			<div class="hidden-xs" onclick="hideHintCookie('howmaxdbsizehint');" style="margin-bottom: 20px;cursor:pointer;text-align: center;font-size: 7pt;margin-top: 5px;color: gray;font-style: italic;"><#LANG_NEWDASH_DONTSHOW_THIS_BLOCK#> <i class="glyphicon glyphicon-arrow-up"></i></div>
		</div>
		
		<div id="structureDB_chart" style="border: 1px solid #ddd;border-radius: 4px;width: 100%;height: 300px;margin-bottom:10px">
			<center style="display: flex;justify-content: center;align-items: center;width: 100%;height: 100%;"><img src="<#ROOTHTML#>img/ajax-loader.gif"/ style="width: 20px;height: 20px;margin-right: 10px;"> <#LANG_NEWDASH_LOADING#></center>
		</div>

    </div>
</div>

<script type="text/javascript">
    $(document).ready(function() {
		checkCategory('myBlockDiv');
		checkCategory('infoBlockDiv');
		checkCategory('cycleBlockDiv');
		checkCategory('scriptBlockDiv');
		checkCategory('newsBlockDiv');
		
		
        checkUpdatesAvailable();
        checkDidYouKnow();
        checkNews();
		//Проверяем скрыли ли подсказки
		hideHintCookie('alert_hide_hint2', 1);
		hideHintCookie('blockdidyouknow', 1);
		hideHintCookie('blockaddnewdev', 1);
		hideHintCookie('howmaxdbsizehint', 1);
		setInterval(function() { checkSystemInfo(); }, 300000);
		checkSystemInfo();
		checkConnectStatus();
		
		myBlockOnDash();
    });
</script>

[#endif#]

